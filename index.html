<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Funding Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading funding data...</p>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h4>Funding Analysis</h4>
            <small>Research Funding Dashboard<br>Keyword-based Classification</small>
        </div>

        <h5>üîç Filters</h5>
        
        <div class="mb-3">
            <label class="form-label">Funding Body</label>
            <select class="form-select form-select-sm" id="filter-funding-body">
                <option value="">All Funding Bodies</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Organisation</label>
            <select class="form-select form-select-sm" id="filter-organisation">
                <option value="">All Organisations</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Funding Scheme</label>
            <select class="form-select form-select-sm" id="filter-scheme">
                <option value="">All Schemes</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Search Investigators</label>
            <input type="text" class="form-control form-control-sm" id="filter-investigator" placeholder="Enter name...">
        </div>

        <button class="btn btn-outline-secondary btn-sm w-100" id="reset-filters">Reset Filters</button>
        <br />
        <br />
        <small>Version 1.0.1 (30 Jan 2026)</small>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Keyword Management Section -->
        <div class="keyword-management-card chart-card">
            <h5>üîë Keywords for Grant Classification</h5>
            <p>These keywords are matched against the grant summaries. Any grant that matches at least one keyword will be included in the 'subset'. Below you can compare this subset against the total dataset.</p>
            <p>Use the filters on the left to further specify which part of the dataset you want to analyse.</p>
            <hr />
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="text-muted">Click √ó to remove a keyword</small>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-danger" id="remove-all-keywords">Remove All</button>
                        <button class="btn btn-outline-secondary" id="restore-defaults">Restore Defaults</button>
                    </div>
                </div>
                <div id="keyword-chips-container" class="d-flex flex-wrap gap-2 mb-3"></div>
                <div class="input-group">
                    <input type="text" class="form-control" id="new-keyword-input" placeholder="Add new keyword...">
                    <button class="btn btn-primary" id="add-keyword-btn">Add</button>
                </div>
                <small class="text-muted">Keywords are case-insensitive and use word boundary matching</small>
            </div>
        </div>

        <!-- KPI Cards Row 1 - Selected Subset -->
        <div class="row mb-3">
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card subset">
                    <div class="kpi-label">Subset Funding Total</div>
                    <div class="kpi-value" id="kpi-subset-funding">$0</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card subset">
                    <div class="kpi-label">Grants in Subset</div>
                    <div class="kpi-value" id="kpi-subset-grants">0</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card subset">
                    <div class="kpi-label">Avg Grant (Subset)</div>
                    <div class="kpi-value" id="kpi-avg-subset-grant">$0</div>
                </div>
            </div>
        </div>

        <!-- KPI Cards Row 2 - Total Filtered -->
        <div class="row mb-3">
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card total">
                    <div class="kpi-label">Total Filtered Funding</div>
                    <div class="kpi-value" id="kpi-total-funding">$0</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card total">
                    <div class="kpi-label">Total Filtered Grants</div>
                    <div class="kpi-value" id="kpi-total-grants">0</div>
                    <small class="text-muted kpi-reference">of <span id="kpi-total-dataset-grants">0</span> total grants</small>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card total">
                    <div class="kpi-label">Avg Grant (Filtered)</div>
                    <div class="kpi-value" id="kpi-avg-grant">$0</div>
                </div>
            </div>
        </div>

        <!-- KPI Cards Row 3 - Percentages -->
        <div class="row mb-4">
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card percentage">
                    <div class="kpi-label">% of Filtered Funding</div>
                    <div class="kpi-value" id="kpi-percentage-funding">0%</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card percentage">
                    <div class="kpi-label">% of Filtered Grants</div>
                    <div class="kpi-value" id="kpi-percentage-grants">0%</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-6 mb-3">
                <div class="kpi-card percentage">
                    <div class="kpi-label">% of Avg Grant</div>
                    <div class="kpi-value" id="kpi-percentage-avg">0%</div>
                </div>
            </div>
        </div>

        <!-- New Charts Row -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Keyword Distribution</h5>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-chart-type active" data-chart="keyword-distribution" data-type="bar">Bar</button>
                            <button class="btn btn-outline-primary btn-chart-type" data-chart="keyword-distribution" data-type="bar-log">Bar (Log)</button>
                            <button class="btn btn-outline-primary btn-chart-type" data-chart="keyword-distribution" data-type="pie">Pie</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-keyword-distribution"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Yearly Trends</h5>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-chart-type active" data-chart="yearly-trends" data-type="number">Number</button>
                            <button class="btn btn-outline-primary btn-chart-type" data-chart="yearly-trends" data-type="amount">Amount</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-yearly-trends"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Funding by Agency</h5>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-chart-type active" data-chart="agency" data-type="bar">Bar</button>
                            <button class="btn btn-outline-primary btn-chart-type" data-chart="agency" data-type="pie">Pie</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-agency"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Subset vs Other Funding</h5>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-chart-type active" data-chart="subset" data-type="doughnut">Donut</button>
                            <button class="btn btn-outline-primary btn-chart-type" data-chart="subset" data-type="bar">Bar</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-subset"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Tables Row -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <h5>Top 10 Organisations (Selected Subset)</h5>
                    <div class="table-responsive" style="max-height: 375px; overflow-y: auto;">
                        <table class="table table-sm table-hover" id="top-orgs-table">
                            <thead class="sticky-top bg-white">
                                <tr>
                                    <th>Organisation</th>
                                    <th class="text-end">Grants</th>
                                    <th class="text-end">Funding</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="chart-card">
                    <h5>Top 10 Schemes (Selected Subset)</h5>
                    <div class="table-responsive" style="max-height: 375px; overflow-y: auto;">
                        <table class="table table-sm table-hover" id="top-schemes-table">
                            <thead class="sticky-top bg-white">
                                <tr>
                                    <th>Scheme</th>
                                    <th class="text-end">Grants</th>
                                    <th class="text-end">Funding</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Data Table -->
        <div class="table-card">
            <h5>üìã Grant Details</h5>
            <div class="table-responsive">
                <table class="table table-striped table-hover" id="grants-table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Type</th>
                            <th>Agency</th>
                            <th>Organisation</th>
                            <th>Scheme</th>
                            <th>Funding</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-4" style="margin-left: calc(-2rem); margin-right: calc(-2rem); margin-bottom: calc(-1.5rem);">
            <div class="container text-center">
                <p class="mb-0">
                    Research Funding Analysis Dashboard | 
                    Data from ARC, NHMRC, and MRFF (2020-2026) |
                    Keyword-based Classification System
                </p>
            </div>
        </footer>
    </div>

    <!-- Detail Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modal-title">Grant Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Grant ID:</strong> <span id="modal-id"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Funding:</strong> <span id="modal-funding"></span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Agency:</strong> <span id="modal-agency"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Type:</strong> <span id="modal-type"></span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <strong>Organisation:</strong> <span id="modal-org"></span>
                    </div>
                    <div class="mb-3">
                        <strong>Scheme:</strong> <span id="modal-scheme"></span>
                    </div>
                    <div class="mb-3">
                        <strong>Investigators:</strong>
                        <p id="modal-investigators" class="text-muted"></p>
                    </div>
                    <div class="mb-3">
                        <strong>Summary:</strong>
                        <pre id="modal-summary" class="bg-light p-3 rounded"></pre>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script type="module" src="scripts/main.js"></script>
</body>
</html>
